<!DOCTYPE html>
<html>
    <head>
        <title>Purdue Formula SAE : Gear Shifting PF20 | Design</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Purdue Formula SAE</a></span>
                            </li>
                                                    <li>
                                <span><a href="Purdue-Formula-SAE-Home_127569448.html">Purdue Formula SAE Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="Electronics_202276996.html">Electronics</a></span>
                            </li>
                                                    <li>
                                <span><a href="259297177.html">Design | ELE</a></span>
                            </li>
                                                    <li>
                                <span><a href="259297208.html">Design Archive | ELE</a></span>
                            </li>
                                                    <li>
                                <span><a href="262832509.html">Design PF20 | ELE</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Purdue Formula SAE : Gear Shifting PF20 | Design
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
    
        
    
        
        
            Created by <span class='author'> Unknown User (tam14)</span>, last modified by <span class='editor'> Paradise, Hunter</span> on Jul 16, 2023
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <h2 id="GearShiftingPF20|Design-ElectronicGearShifting:AHistory">Electronic Gear Shifting: A History</h2><p>Disclaimer: this may be a tad unprofessional because I (Michael Tam) have a long and storied history with trying to implement it. For readers who don't personally know me, there's a good chance that I'm still salty about all of it.</p><p>Pre-2016:</p><p>    Looking through the documentation, the team has explored pneumatic and electronic shifting, but I'm not entirely sure if they implemented it or not. In any case, the technology was not carried over with the switch in engine choice.</p><p>2017:</p><p>    The car was designed to use a mechanical push-pull cable, but we received a gift of a Translogic electronic motorcycle shifting system from an alumni about midway through the season. Right before comp, we modified the car to use the Translogic shifter (don't know for certain what the car ran with- might update if I'm particularly bored some day).</p><p>2018:</p><p>    This is the first year we tried a more custom system. Due to design feedback from comp, we designed the car to utilize the motor from the Translogic system but to be integrated with our ECU. The plan was to use the RaceGrade SSD 3 Sink/Source Driver as a motor controller along with the motor from the Translogic kit. The SSD 3 would then be controlled by the ECU M130. At this point in time, the electronics team had little understanding of the ECU, the SSD 3, and electro-mechanical systems in general. After throwing many hours at trying to figure out how the SSD 3 actually worked, I can conclude that sometimes applying certain voltages works and sometimes it doesn't; this lack of understanding lead to the following incident where I accidentally burnt out both the SSD 3 and the motor (note: don't mess with big power systems after an all-nighter trying to figure out how our CAN communications systems works). We tried to replace the motor with a Neverest 60 and rebuilding the SSD 3 using newer parts after taking it apart and studying the circuit. The one I put together ended up burning during a trial run. Instead, we tried running the Neverest 60 with the Translogic ECU, but the gearbox prevented the Motor from reliably returning. The Translogic motor could return under the power of the return spring, so the Translogic doesn't power the motor on the return cycle; the Neverest 60 will instead sometimes just sit at the end of it's travel. In the end, we ended up just buying a new Translogic kit to replace the first.</p><p>2019:</p><p>    We again attempted a custom system, one that would be backwards compatible with the Translogic system in case it didn't pan out. We used the Neverest 60 with a couple different external motor controllers. The first was a cheap controller off of Amazon, and I could never get it to actually do anything. The second was a Spark Mini; we built a pull-up circuit to a 5V line and then used a half-bridge output as switch to ground. The result meant that we could transmit a varying PWM signal to the motor controller. However, we found that the 5V line is very noisy when the engine is running. I don't think we ever determined the exact cause, but it meant that the precise control signal would be distorted upon reaching the Sparkmini. The distortion as such that it would rapidly switch between Forward, Backwards, Neutral, and Fault no matter what signal was output by the ECU. As such, the Sparkmini could not be used to control the motor. I would like to note that it did work pretty well in isolation; a decent future design might use a PWM-based mictrocontroller on a isolated power circuit. After this attempt, we put the Translogic system on the car and then ran it for comp.</p><p>Summer Testing 2019:</p><p>    I attempted to run the Neverest 60 motor connected directly to the ECU. It half-worked, but there were two notable problems: the first is that the lack of feedback meant that each shift had an element of blind luck as to whether the car actually shifted or not, and the second is that the gearbox for the Neverest 60 is trash. To date, we have snapped the gears of both gearboxes that we have ever ran. Nothing else particularly happened other than that we were plagued by problems stemming from the broken gearbox throughout post-comp testing of the 2019 car.</p><p>2020:</p><p>    Attempting to run a different motor and gearbox combination for this year- a BAG motor paired with a VersaPlanetary Gearbox (not a typo), which will be controlled with a Spark Motor Controller.</p><p><br/></p><h2 id="GearShiftingPF20|Design-2020Design">2020 Design</h2><h3 id="GearShiftingPF20|Design-MotorSelection">Motor Selection</h3><p>Though the shifter armature only needs to move ~7.8 degrees in either direction to shift, the armature can swing 15 degrees from rest. The armature is also spring loaded- it'll increase linearly with distance from rest position until it arrives to the shift point, were it will suddenly jump up and plateau at some maximum torque; this torque is about 22.5 in-lbs. To estimate our torque-speed requirements, I assumed that the arm would need to rotate the maximum distance under the peak torque (25lb-in to be safe). The required torque came out to be 2.8246N*m (just unit conversion), and the shift distance was .2618 radians. To choose a motor, we needed to take a look at the power, and to get power we need to first choose an acceptable shift time. The power for any particular time can be calculated as follows:    Power (W) = Shift Torque (N*m) * Shift_Distance (radians) / Shift_Time (s)</p><p><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image image-center" draggable="false" height="400" src="attachments/127569952/132157503.png" data-image-src="attachments/127569952/132157503.png" data-unresolved-comment-count="0" data-linked-resource-id="132157503" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="shift_time_to_power_req.png" data-base-url="https://wiki.itap.purdue.edu" data-linked-resource-content-type="image/png" data-linked-resource-container-id="127569952" data-linked-resource-container-version="29" alt=""></span></p><p style="text-align: center;"><em>Figure 1: A Plot of Shift Time to Power Required (outdated)<br/></em></p><p>Note that torque and distance are both constants, so power required is a function of just shift time. Looking at the graph, it appears that shift times below 10ms require exponentially more power in exchange for a small amount of gained shift time. Thus we'll aim to pick a motor that can shift in 10ms, or thus produce a bit more than 38.45W at it's peak. Below is a plot of several different motors, one of which is the Neverest 60 that we tried to implement in previous years. Note that the axes have been flipped and that the z-axis is now shift time.</p><p><br/></p><p><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image image-center" draggable="false" height="250" src="attachments/127569952/132157756.png" data-image-src="attachments/127569952/132157756.png" data-unresolved-comment-count="0" data-linked-resource-id="132157756" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="better_3dplot.png" data-base-url="https://wiki.itap.purdue.edu" data-linked-resource-content-type="image/png" data-linked-resource-container-id="127569952" data-linked-resource-container-version="29" alt=""></span></p><p style="text-align: center;"><em>Figure 2: a plot of various power curves to the shift time it achieves</em></p><p>We can see the BAG motor neatly covers the range that we want with taking too much power. It is also worth nothing that the Neo gets very close to achieving 1ms shift times (~1.4ms at its peak), and even without a gearbox it can manage about a ~2.6ms shift, though this is at the cost of drawing 139.3A during the shift, far more than the wires or the motor controller can currently handle. Other considerations that went into choosing the BAG motor is its robustness and small packaging for the power it provides.</p><h3 id="GearShiftingPF20|Design-GearRatioSelection">Gear Ratio Selection</h3><p>For the gearbox, the VersaPlanetary Gearbox was chosen for several different reasons. The gearbox is highly customizable, allowing us to finely choose the ratio, as well as capable of handling high torque loads due to being a planetary gearbox. It was also designed to interface with motors like the BAG motor, so it is easy to assemble the full gearbox. The last critical reason was due to the parallel development of the Electronic Clutch system- we opted to use the same gearbox so that parts could be shared between the two systems.</p><p>In the figure 2, one of the axes is Motor Torque, with more than one value; this is the average torque observed between the motor and the gearbox. By dividing the shift torque by the possible gear ratios of the gearbox, we can find the set of possible average motor torques observed at the motor. The particular torque-speed curve of the motor relates motor torque to a motor speed, and the output power of the motor is determined by the torque and speed output by the motor. Since we need to minimize shift time, we thus need to maximize the power output by the motor. In summary:<br/>Motor Torque = Required Shift Torque / Gear Reduction</p><p>Power = Motor Torque * Motor Speed</p><p>Let's first look at the torque speed curve of the BAG motor, as well as the resulting power curve:</p><p><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image image-center" draggable="false" height="250" src="attachments/127569952/132157758.png" data-image-src="attachments/127569952/132157758.png" data-unresolved-comment-count="0" data-linked-resource-id="132157758" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="bag_torque_speed_curve.png" data-base-url="https://wiki.itap.purdue.edu" data-linked-resource-content-type="image/png" data-linked-resource-container-id="127569952" data-linked-resource-container-version="29" alt=""></span></p><p style="text-align: center;"><br/></p><p style="text-align: center;">Figure 3: the torque speed curve of the BAG Motor</p><p><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image image-center" draggable="false" height="250" src="attachments/127569952/132157759.png" data-image-src="attachments/127569952/132157759.png" data-unresolved-comment-count="0" data-linked-resource-id="132157759" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="bag_curve_through_space.png" data-base-url="https://wiki.itap.purdue.edu" data-linked-resource-content-type="image/png" data-linked-resource-container-id="127569952" data-linked-resource-container-version="29" alt=""></span></p><p style="text-align: center;">Figure 4: the power curve of the BAG motor</p><p style="text-align: left;">Since I'm lazy and don't want to type words, several points should be obvious: 1) torque and motor speed are inversely proportional, 2) we derive the most power from a motor halfway along the torque speed curve (at least ones with permanent magnets), and 3) that the motor will shift the fastest when the motor is operating near the middle of the curve. Thus we need to choose a gear ratio such that the torque seen by the motor is roughly around the torque where the motor produces the most power. Here's a list of reductions, the current draw, and the power that would result from using that reduction:</p><p style="text-align: center;"><code>100:1 ratio, 3.742595 A, 36.424428 W</code></p><p style="text-align: center;"><code> 90:1 ratio, 4.158439 A, 40.155428 W</code></p><p style="text-align: center;"><code> 81:1 ratio, 4.620488 A, 44.226824 W</code></p><p style="text-align: center;"><code> 70:1 ratio, 5.346564 A, 50.467010 W</code></p><p style="text-align: center;"><code> 63:1 ratio, 5.940627 A, 55.429235 W</code></p><p style="text-align: center;"><code> 50:1 ratio, 7.485190 A, 67.727092 W</code></p><p style="text-align: center;"><code> 49:1 ratio, 7.637949 A, 68.895960 W</code></p><p style="text-align: center;"><code> 45:1 ratio, 8.316878 A, 73.987692 W</code></p><p style="text-align: center;"><code> 40:1 ratio, 9.356488 A, 81.457764 W</code></p><p style="text-align: center;"><code> 36:1 ratio, 10.396097 A, 88.532637 W</code></p><p style="text-align: center;"><code> 35:1 ratio, 10.693129 A, 90.481443 W</code></p><p style="text-align: center;"><code> 30:1 ratio, 12.475317 A, 101.496792 W</code></p><p style="text-align: center;"><code> 28:1 ratio, 13.366411 A, 106.568942 W</code></p><p style="text-align: center;"><code> 27:1 ratio, 13.861463 A, 109.261344 W</code></p><p style="text-align: center;"><code> 25:1 ratio, 14.970380 A, 114.967133 W</code></p><p style="text-align: center;"><code> 21:1 ratio, 17.821881 A, 127.574454 W</code></p><p style="text-align: center;"><code> 20:1 ratio, 18.712975 A, 130.904509 W</code></p><p style="text-align: center;"><code> 16:1 ratio, 23.391219 A, 143.623749 W</code></p><p style="text-align: center;"><code> 15:1 ratio, 24.950633 A, 146.085106 W</code></p><p style="text-align: center;"><code> 12:1 ratio, 31.188292 A, 147.038584 W</code></p><p style="text-align: center;"><code> 10:1 ratio, 37.425950 A, 133.764942 W</code></p><p style="text-align: center;"><code>  9:1 ratio, 41.584389 A, 117.011893 W</code></p><p style="text-align: center;"><code>  7:1 ratio, 53.465643 A, 34.304112 W</code></p><p style="text-align: center;"><em>Table 1: a list of the motor current and power output for different combinations of VersaPlanetary Gear Stages</em></p><p style="text-align: left;"><br/></p><p style="text-align: left;"><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image image-center" draggable="false" height="250" src="attachments/127569952/137592879.png" data-image-src="attachments/127569952/137592879.png" data-unresolved-comment-count="0" data-linked-resource-id="137592879" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="power_with_gearpoints.png" data-base-url="https://wiki.itap.purdue.edu" data-linked-resource-content-type="image/png" data-linked-resource-container-id="127569952" data-linked-resource-container-version="29" alt=""></span></p><p style="text-align: center;"><em>Figure 5: a plot of the various torque-power points and some reference lines </em></p><p style="text-align: left;">From the table, you can see that the best power comes when you apply a 12:1 speed reduction to the motor; if your reduction is too low or too high, the motor is either doesn't have enough torque to turn the load in the first place or the speed is reduced so much that shift time is limited by the motor power. For the motor, I ended up choosing the 16:1 reduction because it would bias the motor fairly close to it's maximum power and because the gearbox would consist of two 4:1 stages, making it easy to stock replacements.</p><h3 style="text-align: left;" id="GearShiftingPF20|Design-MotorControllerSelection">Motor Controller Selection</h3><p>In this section, I will lump together the motor controller and the module that we will use to control the controller. Motor controller selection is dictated by the current draw of the motor and the devices that we can interface with. We decided to go with the Spark Max because it can tolerate 60A currents as well as spikes up to 100A, which is much more than we will need for the BAG motor and the 16:1 gearing (note that the BAG motor will draw roughly 23.4A during a shift in this configuration). The motor controller bases it's output on a 5V PWM line, for which we will use a Teensy 4.0. The Teensy is a fairly robust board with many peripherals: we will be able to output the PWM signal for the motor input, as well as read digital signals from the encoder to get the position of the motor as well as transmit and receive CAN messages, which will be needed to communicate with the rest of the car.</p><p><br/></p><p>I might add to that last section later, probably should update the rest first</p><p><br/></p><p><span class="confluence-embedded-file-wrapper"><a class="confluence-embedded-file" href="/download/attachments/127569952/plot_stuff.m?version=1&amp;modificationDate=1577140031000&amp;api=v2" data-nice-type="null" data-file-src="/download/attachments/127569952/plot_stuff.m?version=1&amp;modificationDate=1577140031000&amp;api=v2" data-linked-resource-id="137592884" data-linked-resource-type="attachment" data-linked-resource-container-id="127569952" data-linked-resource-default-alias="plot_stuff.m" data-mime-type="application/octet-stream" data-has-thumbnail="false" data-linked-resource-version="1" data-can-edit="true" aria-label="plot_stuff.m" draggable="false"><img src="download/resources/com.atlassian.confluence.plugins.confluence-view-file-macro:view-file-macro-resources/images/placeholder-medium-file.png" height="250" alt="" draggable="false"/><span class="title">plot_stuff.m</span></a><span class="companion-edit-button-placeholder edit-button-overlay" data-linked-resource-container-id="127569952" data-linked-resource-id="137592884" data-template-name="companionEditIcon" data-source-location="embedded-attachment"></span></span></p><p><span class="confluence-embedded-file-wrapper"><a class="confluence-embedded-file" href="/download/attachments/127569952/plot_stuff_2.m?version=1&amp;modificationDate=1577140031000&amp;api=v2" data-nice-type="null" data-file-src="/download/attachments/127569952/plot_stuff_2.m?version=1&amp;modificationDate=1577140031000&amp;api=v2" data-linked-resource-id="137592882" data-linked-resource-type="attachment" data-linked-resource-container-id="127569952" data-linked-resource-default-alias="plot_stuff_2.m" data-mime-type="application/octet-stream" data-has-thumbnail="false" data-linked-resource-version="1" data-can-edit="true" aria-label="plot_stuff_2.m" draggable="false"><img src="download/resources/com.atlassian.confluence.plugins.confluence-view-file-macro:view-file-macro-resources/images/placeholder-medium-file.png" height="250" alt="" draggable="false"/><span class="title">plot_stuff_2.m</span></a><span class="companion-edit-button-placeholder edit-button-overlay" data-linked-resource-container-id="127569952" data-linked-resource-id="137592882" data-template-name="companionEditIcon" data-source-location="embedded-attachment"></span></span></p><p><span class="confluence-embedded-file-wrapper"><a class="confluence-embedded-file" href="/download/attachments/127569952/plot_stuff_3.m?version=1&amp;modificationDate=1577140031000&amp;api=v2" data-nice-type="null" data-file-src="/download/attachments/127569952/plot_stuff_3.m?version=1&amp;modificationDate=1577140031000&amp;api=v2" data-linked-resource-id="137592883" data-linked-resource-type="attachment" data-linked-resource-container-id="127569952" data-linked-resource-default-alias="plot_stuff_3.m" data-mime-type="application/octet-stream" data-has-thumbnail="false" data-linked-resource-version="1" data-can-edit="true" aria-label="plot_stuff_3.m" draggable="false"><img src="download/resources/com.atlassian.confluence.plugins.confluence-view-file-macro:view-file-macro-resources/images/placeholder-medium-file.png" height="250" alt="" draggable="false"/><span class="title">plot_stuff_3.m</span></a><span class="companion-edit-button-placeholder edit-button-overlay" data-linked-resource-container-id="127569952" data-linked-resource-id="137592883" data-template-name="companionEditIcon" data-source-location="embedded-attachment"></span></span></p>
                    </div>

                                                            <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/127569952/132157503.png">shift_time_to_power_req.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/127569952/132157741.png">torque_power_shifttime_3d_graph.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/127569952/132157748.fig">torque_power_shifttime_3d_graph.fig</a> (application/octet-stream)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/127569952/132157747.fig">torque_power_shifttime_3d_graph.fig</a> (application/octet-stream)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/127569952/132157756.png">better_3dplot.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/127569952/132157758.png">bag_torque_speed_curve.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/127569952/132157759.png">bag_curve_through_space.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/127569952/137592879.png">power_with_gearpoints.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/127569952/137592882.m">plot_stuff_2.m</a> (application/octet-stream)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/127569952/137592883.m">plot_stuff_3.m</a> (application/octet-stream)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/127569952/137592884.m">plot_stuff.m</a> (application/octet-stream)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Mar 04, 2024 13:33</p>
                    <div id="footer-logo"><a href="https://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
